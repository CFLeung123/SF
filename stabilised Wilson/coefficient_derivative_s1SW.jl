# Define the input text
input_text = """
dot(p)_11(L=4)=  3.64206917565083701774153760088257832e-02

dot(p)_11(L=5)=  4.7608825267196308541286607966626192e-02

dot(p)_11(L=6)=  5.82699643659506978113879129236589514e-02

dot(p)_11(L=7)=  6.87031123253090806416678694119704845e-02

dot(p)_11(L=8)=  7.89752312167173166405097914293694544e-02

dot(p)_11(L=9)=  8.91177218077488310712902506013697346e-02

dot(p)_11(L=10)=  9.91570386085865140033606379418553971e-02

dot(p)_11(L=11)=  1.09115755586793066490758772865371057e-01

dot(p)_11(L=12)=  1.19011756156040671716351307134513687e-01

dot(p)_11(L=13)=  1.28858599240767640529689302382595576e-01

dot(p)_11(L=14)=  1.38666416812919606032026471971971972e-01

dot(p)_11(L=15)=  1.48442803772389351373743335778671448e-01

dot(p)_11(L=16)=  1.58193521153181710058947091832347826e-01

dot(p)_11(L=17)=  1.67923005462696225252664719477109133e-01

dot(p)_11(L=18)=  1.7763472635252167662872412146318839e-01

dot(p)_11(L=19)=  1.87331436816182935389136053785836856e-01

dot(p)_11(L=20)=  1.970153498699529777917431255655351e-01

dot(p)_11(L=21)=  2.06688265239793656885105467603401245e-01

dot(p)_11(L=22)=  2.1635166175791274919657572840258972e-01

dot(p)_11(L=23)=  2.26006765879941576923590035266648877e-01

dot(p)_11(L=24)=  2.3565460328066400491799804598557961e-01

dot(p)_11(L=25)=  2.4529603824923486500201816230325771e-01

dot(p)_11(L=26)=  2.54931804144279891016052112024446465e-01

dot(p)_11(L=27)=  2.64562527201183094669328196615067329e-01

dot(p)_11(L=28)=  2.74188745330582675559714376847863682e-01

dot(p)_11(L=29)=  2.83810923098109231194387578320975149e-01

dot(p)_11(L=30)=  2.93429463761419115907671018052323621e-01

dot(p)_11(L=31)=  3.03044719017487526197906946038513081e-01

dot(p)_11(L=32)=  3.12656996952328304236631484645661437e-01

dot(p)_11(L=33)=  3.22266568567902919621030868267366799e-01

dot(p)_11(L=34)=  3.3187367317425560016695078237593573e-01

dot(p)_11(L=35)=  3.41478522870167087330713408819027399e-01

dot(p)_11(L=36)=  3.51081306286814449664327525058898517e-01

dot(p)_11(L=37)=  3.6068219173180467096044995693183936e-01

dot(p)_11(L=38)=  3.70281329842482613322776706256000728e-01

dot(p)_11(L=39)=  3.79878855835413078155616585250888266e-01

dot(p)_11(L=40)=  3.8947489142180961541761218997968255e-01

dot(p)_11(L=41)=  3.99069546445258609414522355763531392e-01

dot(p)_11(L=42)=  4.08662920287497538816946758504967648e-01

dot(p)_11(L=43)=  4.18255103079601716417133148548138431e-01

dot(p)_11(L=44)=  4.27846176749224845045229310210451817e-01

dot(p)_11(L=45)=  4.37436215929153892017233112912101077e-01
 
dot(p)_11(L=46)=  4.47025288748094178047846048225083856e-01

dot(p)_11(L=47)=  4.56613457521077815165491115132458773e-01

dot(p)_11(L=48)=  4.6620077935401869599031842888773407e-01
"""

#Extrapolation
using DoubleFloats
using Quadmath
const delta = 1
const Lmin = 4

# Extract the numbers using a regular expression
f = [parse(Float128, match(r"[-+]?\d*\.\d+([eE][-+]?\d+)?", line).match) for line in split(input_text, '\n') if match(r"[-+]?\d*\.\d+([eE][-+]?\d+)?", line)!==nothing]

print(f)


function R0(f)
    R0f = Array{Float128}(undef, length(f) - delta)
    for i in 1:length(f)-delta
        L = Lmin -1 +i
        R0f[i] = Float128(L / delta) * (f[i+delta] - f[i])
    end
    return R0f
end

function Rnu(nu, f)
    Rnuf = Array{Float128}(undef, length(f) - delta)
    for i in 1:length(f)-delta
        L = Lmin -1 +i
        Rnuf[i] = f[i] + Float128(L / (nu * delta)) * (f[i+delta] - f[i])
    end
    return Rnuf
end

function scale(f)
    for i in 1:length(f)
        L = Lmin -1+i
        f[i] = (1+1/Float128(2L))*f[i]
    end
    return f
end

function extrapolationf(f)
    final = Rnu(2,Rnu(2,Rnu(1,Rnu(1,f))))
    for l in 1:length(final)
        @inbounds begin
            L = l - 1 + Lmin
            final[l] = L*(f[l]-final[l])
            println(' ')
        println("F1(L=$L)= ", final[l])
        end
    end
    return final
end


for i in 1:length(f)
    L = Lmin-1+i
    f[i] = f[i] / L
    println(' ')
    println("f(L=$L)/L= ", f[i])
end
println(" -------------------------------------------------------- ")
final1 = extrapolationf(f)
final = Rnu(2,Rnu(2,Rnu(1,Rnu(1,R0(final1)))))
for l in 1:length(final)
    @inbounds begin
        L = l - 1 + Lmin
        println(' ')
        println("Final(L=$L)= ", final[l])
    end
end
